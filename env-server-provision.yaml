- hosts: 
    - web-server
  remote_user: testadmin
  become: true
  become_method: sudo
  vars_files: 
    - vars.yaml
  vars:
    ansible_ssh_private_key_file: "{{ ansible_ssh_private_key_file }}"
    ansible_python_interpreter: "{{ ansible_python_interpreter }}"

  tasks:
    - name: Update all packages
      apt:
        update_cache: yes
        name: "*"
        state: latest

    - name: Install system dependecies
      become: yes
      become_method: sudo
      apt:
        name: 
          - build-essential
          - python3
          - python3-pip

    - name: Install pip dependecies
      become: yes
      become_method: sudo
      pip:
        name: 
          - virtualenv
          - setuptools
    
    - name: Copy a requirements file on the remote machine
      ansible.builtin.copy:
        src: /home/danyil/ansible/requirements.txt
        dest: /home/testadmin/requirements.txt
        remote_src: false
        follow: yes

    - name: Install specified python requirements in indicated (virtualenv)
      pip:
        requirements: /home/testadmin/requirements.txt
        virtualenv: /home/testadmin/requirements/
        